<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
   <link rel="stylesheet" href="/libs/highlight/github.min.css">
   
  <link rel="stylesheet" href="/css/franklin.css">
  <link rel="stylesheet" href="/css/basic.css">
  <link rel="icon" href="/assets/favicon.png">
   <title> Plotting using the visit-cli</title>  
</head>
<body>
  <header>
<div class="blog-name"><a href="/">Vikash Pandey</a></div>
<nav>
  <ul>
    <li><a href="/">Home</a></li>
    <li><a href="/Research/">Research</a></li>
    <li><a href="/journal/">Blogs</a></li>
    <li><a href="/hacks/">Unintended hacks</a></li>
  </ul>
  <img src="/assets/hamburger.svg" id="menu-icon">
</nav>
</header>


<!-- Content appended here -->
<div class="franklin-content"><p><a href="https://wci.llnl.gov/simulation/computer-codes/visit">Visit</a> is a visualization software developed by Lawrence Livermore National Laboratory for visualization of large scale data sets. A detailed discussion of the software can be found <a href="https://www.visitusers.org/index.php?title&#61;500words">here</a>, which is a 500 words essay. I use visit for visualizing the 3-dimensional datasets. Although their GUI is pretty intuitive, it is nice to use the <a href="https://visit-sphinx-github-user-manual.readthedocs.io/en/v3.2.1/cli_manual/index.html">python API</a>&#39;s to loop over many data sets residing in remote server and plot them simultaneously. Surely one will appreciate the advantage when the internet connection is poor.</p>
<h1 id="the_pledge"><a href="#the_pledge" class="header-anchor">The pledge</a></h1>

   <div class="row">
     <div class="container">
     <center>
      <img src="/journal/fig/second_blog_wf.png" alt="drawing" width="100"/>
     </center>
       <p>
       The chart summarizes the workflow that I want to achieve
       </p>
       <div style="clear: both"></div>      
     </div>
   </div>
   
<h1 id="the_turn"><a href="#the_turn" class="header-anchor">The turn</a></h1>
<p>I will start by creating a <a href="https://hdf5group.org">hdf5</a> file which can be read very easily in visit. I will use the following code block to store random data in a file called <code>test_file.h5</code>. I have basically created a dataset &quot;x&quot; and stored a three dimensional array in it.</p>
<pre><code class="language-python">import numpy as np
import h5py 
n1 &#61; 64
u &#61; np.sin&#40;np.random.random&#40;n1*n1*n1&#41;*np.pi*2&#41;
u &#61; u.reshape&#40;n1,n1,n1&#41;
with h5py.File&#40;&#39;test_file.h5&#39;,&#39;w&#39;&#41; as f:
  f.create_dataset&#40;&#39;x&#39;,data&#61;u&#41;</code></pre>
<p>I will now make a different file <code>visit_plot.py</code> where I will call necessary visit API&#39;s to make a contour plot of &quot;x&quot;. <a href="https://www.gnu.org/software/emacs/">Emacs</a> users can create a python source block with headers <code>:tangle visit_plot.py</code> and run <code>M-x org-babel-tangle</code> to export the content.</p>
<p>The call to visit API&#39;s follow a general procedure. First one needs to import all the <code>visit_utils</code>.</p>
<pre><code class="language-python">from visit_utils import *</code></pre>
<p>The above call will allow one to change the different plot attributes of visit given in <a href="https://visit-sphinx-github-user-manual.readthedocs.io/en/v3.2.1/cli_manual/index.html">https://visit-sphinx-github-user-manual.readthedocs.io/en/v3.2.1/cli_manual/index.html</a>. Out of the hundreds, of API&#39;s I will call a few and change its attributes.  First I will fix the view by setting the normal vector to face outwards the computer screen and the up vector towards positive of z axis.</p>
<pre><code class="language-python">ResetView&#40;&#41;
v &#61; GetView3D&#40;&#41;
v.viewNormal &#61; &#40;0.5, -0.4, 0.1&#41;
v.viewUp &#61; &#40;0, 0, 1&#41;
SetView3D&#40;v&#41;</code></pre>
<p>I will set some of the box-attributes where I will set the triad, the information on the database and the bounding box to be visible. If you like the default picture from the visit then this block can be ignored.</p>
<pre><code class="language-python">ats &#61; AnnotationAttributes&#40;&#41;
ats.axes3D.visible &#61; 0
ats.axes3D.triadFlag &#61; 1
ats.axes3D.bboxFlag &#61; 1
ats.userInfoFlag &#61; 0
ats.databaseInfoFlag &#61; 1
ats.legendInfoFlag &#61; 1
ats.axes3D.xAxis.grid &#61; 0
ats.axes3D.yAxis.grid &#61; 0
ats.axes3D.zAxis.grid &#61; 0
ats.axes3D.yAxis.label.font.bold &#61; 0
ats.axes3D.yAxis.label.font.scale &#61; 1
ats.axes3D.setBBoxLocation &#61; 1
ats.axes3D.lineWidth &#61; 3
ats.axes3D.bboxLocation &#61; &#40;1, 64, 1, 64, 1, 64&#41; 
SetAnnotationAttributes&#40;ats&#41;</code></pre>
<p>The next part is to set the format and file name of the saved image. Out of the available formats, BMP, CURVE, JPEG, OBJ, PNG, POSTSCRIPT, POVRAY, PPM, RGB, STL, TIFF, ULTRA, VTK, PLY, and EXR, I will save a png image of size 768x512 pixels.</p>
<pre><code class="language-python">s &#61; SaveWindowAttributes&#40;&#41;
s.format &#61; s.PNG
s.fileName &#61; &#39;fig/test_out&#39; 
s.outputDirectory &#61; &quot;./&quot;
s.width, s.height &#61; 768,512
s.screenCapture &#61; 0
SetSaveWindowAttributes&#40;s&#41;</code></pre>
<p>Finally the code below will make the contour of the data we had stored and save the image. Basically, I am plotting the contours of iso-values 0.2 and 0.4 and coloring them with <code>SetMulticolor</code> calls.</p>
<pre><code class="language-python">OpenDatabase&#40;&#39;test_file.h5&#39;&#41;
AddPlot&#40;&quot;Contour&quot;, &quot;x&quot;&#41;
pc &#61; ContourAttributes&#40;&#41;
pc.contourMethod &#61; pc.Value
pc.contourValue &#61; &#40;0.2, 0.4&#41;
pc.SetMultiColor&#40;0, &#40;255, 127,   0, 255&#41; &#41;
pc.SetMultiColor&#40;1, &#40;106,  61, 154, 255&#41; &#41;
SetPlotOptions&#40;pc&#41;
DrawPlots&#40;&#41; 
SaveWindow&#40;&#41;
CloseDatabase&#40;&#41;
exit&#40;&#41;</code></pre>
<h1 id="the_prestige"><a href="#the_prestige" class="header-anchor">The Prestige</a></h1>
<p>To get the desired image open a terminal and run the following.</p>
<pre><code class="language-shell">/path/to/visit -nowin -cli -s visit_plot.py</code></pre>
<p><img src="/journal/fig/test_out.png" alt="img" /></p>
<div class="page-foot">
  <div class="copyright">
    &copy; VP. Last modified: August 20, 2021. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
  </div>
</div>
</div><!-- CONTENT ENDS HERE -->
    
    
        <script src="/libs/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();hljs.configure({tabReplace: '    '});</script>

    
  </body>
</html>
